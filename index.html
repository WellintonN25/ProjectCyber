<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Battle Arena</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #2c1810;
            background-image: 
                repeating-linear-gradient(0deg, rgba(0,0,0,.3) 0px, transparent 1px, transparent 2px, rgba(0,0,0,.3) 3px),
                repeating-linear-gradient(90deg, rgba(0,0,0,.3) 0px, transparent 1px, transparent 2px, rgba(0,0,0,.3) 3px);
            color: #f4e4c1;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .paper-texture {
            background: linear-gradient(rgba(244, 228, 193, 0.95), rgba(244, 228, 193, 0.95)),
                        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" /></filter><rect width="100" height="100" filter="url(%23noise)" opacity="0.05"/></svg>');
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), inset 0 0 100px rgba(139, 90, 43, 0.1);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Tela de Login */
        .login-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: linear-gradient(rgba(244, 228, 193, 0.98), rgba(244, 228, 193, 0.98));
            border: 4px solid #8b5a2b;
            border-radius: 5px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7), inset 0 0 50px rgba(139, 90, 43, 0.1);
            position: relative;
        }

        .login-box::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: #5c3317;
            z-index: -1;
            border-radius: 5px;
        }

        .login-box h1 {
            text-align: center;
            color: #5c3317;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            border-bottom: 3px solid #8b5a2b;
            padding-bottom: 15px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #5c3317;
            font-size: 1.1em;
            font-weight: bold;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.8);
            border: 3px solid #8b5a2b;
            border-radius: 3px;
            color: #2c1810;
            font-size: 1em;
            font-family: 'Courier New', monospace;
        }

        .input-group input:focus {
            outline: none;
            border-color: #5c3317;
            background: rgba(255, 255, 255, 0.95);
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(180deg, #8b5a2b 0%, #5c3317 100%);
            border: 3px solid #3d2212;
            border-radius: 5px;
            color: #f4e4c1;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .btn:hover {
            background: linear-gradient(180deg, #a0652f 0%, #6d3d1a 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Cria√ß√£o de Personagem */
        .character-creation {
            display: none;
        }

        .creation-box {
            background: linear-gradient(rgba(244, 228, 193, 0.98), rgba(244, 228, 193, 0.98));
            border: 4px solid #8b5a2b;
            border-radius: 5px;
            padding: 30px;
            margin: 20px auto;
            max-width: 600px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
        }

        .creation-box h2 {
            color: #5c3317;
            border-bottom: 3px solid #8b5a2b;
            padding-bottom: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .avatar-preview {
            text-align: center;
            margin: 30px 0;
        }

        .avatar-display {
            width: 150px;
            height: 150px;
            background: rgba(139, 90, 43, 0.2);
            border: 4px solid #8b5a2b;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 5em;
            margin-bottom: 15px;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .emoji-option {
            padding: 15px;
            font-size: 2em;
            background: rgba(139, 90, 43, 0.1);
            border: 3px solid #8b5a2b;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .emoji-option:hover {
            background: rgba(139, 90, 43, 0.3);
            transform: scale(1.1);
        }

        .emoji-option.selected {
            background: rgba(139, 90, 43, 0.5);
            border-color: #5c3317;
            transform: scale(1.15);
        }

        /* Menu Principal */
        .main-menu {
            display: none;
        }

        .menu-paper {
            background: linear-gradient(rgba(244, 228, 193, 0.98), rgba(244, 228, 193, 0.98));
            border: 4px solid #8b5a2b;
            border-radius: 5px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
        }

        .menu-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .menu-header h1 {
            font-size: 3em;
            color: #5c3317;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
            border-bottom: 4px solid #8b5a2b;
            padding-bottom: 15px;
        }

        .player-info-card {
            background: rgba(139, 90, 43, 0.15);
            border: 3px solid #8b5a2b;
            border-radius: 5px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .player-info-card h2 {
            color: #5c3317;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .player-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.5);
            padding: 12px;
            border: 2px solid #8b5a2b;
            border-radius: 3px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.9em;
            color: #5c3317;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .stat-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c1810;
        }

        .menu-buttons {
            display: grid;
            gap: 15px;
        }

        .menu-btn {
            padding: 20px;
            background: linear-gradient(180deg, #8b5a2b 0%, #5c3317 100%);
            border: 3px solid #3d2212;
            border-radius: 5px;
            color: #f4e4c1;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .menu-btn:hover {
            background: linear-gradient(180deg, #a0652f 0%, #6d3d1a 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        /* Tela de Batalha */
        .battle-screen {
            display: none;
        }

        .battle-paper {
            background: linear-gradient(rgba(244, 228, 193, 0.98), rgba(244, 228, 193, 0.98));
            border: 4px solid #8b5a2b;
            border-radius: 5px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
        }

        .battle-header {
            background: rgba(139, 90, 43, 0.2);
            padding: 15px;
            border: 2px solid #8b5a2b;
            border-radius: 3px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #2c1810;
            font-weight: bold;
        }

        .battle-arena {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 30px;
        }

        .character {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            min-width: 180px;
        }

        .character-avatar {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            border: 4px solid #8b5a2b;
            background: rgba(139, 90, 43, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .character-avatar.attacking {
            animation: attack 0.5s ease;
        }

        @keyframes attack {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(30px) scale(1.2); }
        }

        .character-avatar.damaged {
            animation: damage 0.5s ease;
        }

        @keyframes damage {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-15px) rotate(-5deg); }
            75% { transform: translateX(15px) rotate(5deg); }
        }

        .character-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c1810;
            margin-bottom: 8px;
        }

        .character-level {
            font-size: 1em;
            color: #8b5a2b;
            margin-bottom: 12px;
            font-weight: bold;
        }

        .hp-bar-container {
            width: 100%;
            height: 28px;
            background: rgba(139, 90, 43, 0.2);
            border: 3px solid #8b5a2b;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
            margin-bottom: 5px;
        }

        .hp-bar {
            height: 100%;
            background: linear-gradient(90deg, #c41e3a, #e63946);
            transition: width 0.5s ease;
        }

        .hp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.9em;
            font-weight: bold;
            color: #2c1810;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

        .battle-log {
            background: rgba(139, 90, 43, 0.15);
            border: 3px solid #8b5a2b;
            border-radius: 3px;
            padding: 15px;
            height: 150px;
            overflow-y: auto;
            margin-bottom: 20px;
            font-size: 0.95em;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.4);
            border-left: 3px solid #8b5a2b;
            color: #2c1810;
        }

        .battle-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .attack-btn {
            padding: 18px;
            background: linear-gradient(180deg, #c41e3a 0%, #a01629 100%);
            border: 3px solid #7a0f1d;
            border-radius: 5px;
            color: #f4e4c1;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .attack-btn:hover:not(:disabled) {
            background: linear-gradient(180deg, #d62839 0%, #b01c2e 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(196, 30, 58, 0.5);
        }

        .attack-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .attack-btn.special {
            background: linear-gradient(180deg, #d4a017 0%, #b8860b 100%);
            border-color: #8b6914;
        }

        .attack-btn.special:hover:not(:disabled) {
            background: linear-gradient(180deg, #e6b71e 0%, #c89d1a 100%);
        }

        .attack-btn.ultimate {
            background: linear-gradient(180deg, #7b2cbf 0%, #5a189a 100%);
            border-color: #3c096c;
        }

        .attack-btn.ultimate:hover:not(:disabled) {
            background: linear-gradient(180deg, #9d4edd 0%, #6a1fa8 100%);
        }

        /* Loja */
        .shop-screen {
            display: none;
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .shop-item {
            background: rgba(139, 90, 43, 0.15);
            border: 3px solid #8b5a2b;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .shop-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .shop-item-icon {
            font-size: 3.5em;
            margin-bottom: 15px;
        }

        .shop-item-name {
            font-weight: bold;
            color: #2c1810;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .shop-item-stats {
            font-size: 0.9em;
            color: #5c3317;
            margin-bottom: 12px;
        }

        .shop-item-price {
            color: #8b5a2b;
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .buy-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(180deg, #8b5a2b 0%, #5c3317 100%);
            border: 2px solid #3d2212;
            border-radius: 3px;
            color: #f4e4c1;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }

        .buy-btn:hover:not(:disabled) {
            background: linear-gradient(180deg, #a0652f 0%, #6d3d1a 100%);
            transform: scale(1.05);
        }

        .buy-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Invent√°rio */
        .inventory-screen {
            display: none;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .inventory-item {
            background: rgba(139, 90, 43, 0.15);
            border: 3px solid #8b5a2b;
            border-radius: 5px;
            padding: 18px;
            text-align: center;
        }

        .inventory-item.equipped {
            border-color: #d4a017;
            background: rgba(212, 160, 23, 0.2);
            box-shadow: 0 0 15px rgba(212, 160, 23, 0.3);
        }

        .equip-btn {
            width: 100%;
            padding: 10px;
            margin-top: 12px;
            background: linear-gradient(180deg, #8b5a2b 0%, #5c3317 100%);
            border: 2px solid #3d2212;
            border-radius: 3px;
            color: #f4e4c1;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }

        .equip-btn:hover {
            background: linear-gradient(180deg, #a0652f 0%, #6d3d1a 100%);
        }

        .back-btn {
            padding: 12px 30px;
            background: linear-gradient(180deg, #8b5a2b 0%, #5c3317 100%);
            border: 3px solid #3d2212;
            border-radius: 5px;
            color: #f4e4c1;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
        }

        .back-btn:hover {
            background: linear-gradient(180deg, #a0652f 0%, #6d3d1a 100%);
            transform: translateY(-2px);
        }

        .damage-text {
            position: fixed;
            font-size: 2.5em;
            font-weight: bold;
            color: #c41e3a;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8), 0 0 10px #fff;
            animation: damageFloat 1.2s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes damageFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(1.8);
            }
        }

        .hidden {
            display: none !important;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .emoji-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .battle-arena {
                flex-direction: column;
            }

            .menu-header h1 {
                font-size: 2.2em;
            }

            .character-avatar {
                width: 110px;
                height: 110px;
                font-size: 3.5em;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }

            .login-box, .creation-box, .menu-paper, .battle-paper {
                padding: 20px;
            }

            .player-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .emoji-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Tela de Login -->
        <div class="login-screen" id="loginScreen">
            <div class="login-box">
                <h1>‚öîÔ∏è RPG BATTLE ‚öîÔ∏è</h1>
                <div class="input-group">
                    <label>Usu√°rio</label>
                    <input type="text" id="username" placeholder="Digite seu usu√°rio">
                </div>
                <div class="input-group">
                    <label>Senha</label>
                    <input type="password" id="password" placeholder="Digite sua senha">
                </div>
                <button class="btn" onclick="game.login()">Entrar</button>
                <button class="btn" onclick="game.register()">Criar Conta</button>
            </div>
        </div>

        <!-- Cria√ß√£o de Personagem -->
        <div class="character-creation" id="characterCreation">
            <div class="creation-box">
                <h2>‚öîÔ∏è CRIE SEU PERSONAGEM ‚öîÔ∏è</h2>
                
                <div class="avatar-preview">
                    <div class="avatar-display" id="avatarPreview">ü¶∏</div>
                </div>

                <div class="input-group">
                    <label>Nome do Personagem</label>
                    <input type="text" id="characterName" placeholder="Digite o nome" maxlength="20">
                </div>

                <div class="input-group">
                    <label>Escolha seu Avatar</label>
                    <div class="emoji-grid" id="avatarGrid"></div>
                </div>

                <button class="btn" onclick="game.createCharacter()">Criar Personagem</button>
            </div>
        </div>

        <!-- Menu Principal -->
        <div class="main-menu" id="mainMenu">
            <div class="menu-paper">
                <div class="menu-header">
                    <h1>‚öîÔ∏è BATTLE ARENA ‚öîÔ∏è</h1>
                </div>
                <div class="player-info-card">
                    <h2 id="playerNameDisplay">Guerreiro</h2>
                    <div class="player-stats">
                        <div class="stat-item">
                            <div class="stat-label">N√≠vel</div>
                            <div class="stat-value" id="playerLevelMenu">1</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">XP</div>
                            <div class="stat-value" id="playerXpMenu">0/100</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Moedas</div>
                            <div class="stat-value" id="playerCoinsMenu">üí∞ 0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Vit√≥rias</div>
                            <div class="stat-value" id="playerWinsMenu">0</div>
                        </div>
                    </div>
                </div>
                <div class="menu-buttons">
                    <button class="menu-btn" onclick="game.startBattle()">‚öîÔ∏è Batalhar</button>
                    <button class="menu-btn" onclick="game.openShop()">üõí Loja</button>
                    <button class="menu-btn" onclick="game.openInventory()">üéí Invent√°rio</button>
                    <button class="menu-btn" onclick="game.openCharacterEdit()">üë§ Editar Personagem</button>
                    <button class="menu-btn" onclick="game.logout()">üö™ Sair</button>
                </div>
            </div>
        </div>

        <!-- Tela de Batalha -->
        <div class="battle-screen" id="battleScreen">
            <div class="battle-paper">
                <button class="back-btn" onclick="game.backToMenu()">‚Üê Voltar</button>
                <div class="battle-header">
                    <div>Batalha #<span id="battleCount">1</span></div>
                    <div>Pr√≥ximo Boss: <span id="bossCountdown">5</span> batalhas</div>
                </div>

                <div class="battle-arena">
                    <div class="character">
                        <div class="character-avatar" id="playerAvatar">ü¶∏</div>
                        <div class="character-name" id="playerName">Guerreiro</div>
                        <div class="character-level">N√≠vel <span id="playerLevel">1</span></div>
                        <div class="hp-bar-container">
                            <div class="hp-bar" id="playerHpBar" style="width: 100%"></div>
                            <div class="hp-text" id="playerHpText">100/100</div>
                        </div>
                    </div>

                    <div style="font-size: 4em; color: #c41e3a;">‚öîÔ∏è</div>

                    <div class="character">
                        <div class="character-avatar" id="enemyAvatar">üëπ</div>
                        <div class="character-name" id="enemyName">Inimigo</div>
                        <div class="character-level">N√≠vel <span id="enemyLevel">1</span></div>
                        <div class="hp-bar-container">
                            <div class="hp-bar" id="enemyHpBar" style="width: 100%"></div>
                            <div class="hp-text" id="enemyHpText">100/100</div>
                        </div>
                    </div>
                </div>

                <div class="battle-log" id="battleLog"></div>

                <div class="battle-controls" id="battleControls">
                    <button class="attack-btn" onclick="game.playerAttack('normal')">‚öîÔ∏è Ataque Normal</button>
                    <button class="attack-btn special" onclick="game.playerAttack('special')" id="specialBtn">‚ú® Ataque Especial</button>
                    <button class="attack-btn ultimate" onclick="game.playerAttack('ultimate')" id="ultimateBtn">üí• Ataque Supremo</button>
                </div>
            </div>
        </div>

        <!-- Tela da Loja -->
        <div class="shop-screen" id="shopScreen">
            <div class="menu-paper">
                <button class="back-btn" onclick="game.backToMenu()">‚Üê Voltar</button>
                <h2 style="color: #2c1810; margin-bottom: 15px; text-align: center; border-bottom: 3px solid #8b5a2b; padding-bottom: 10px;">üõí Loja de Itens</h2>
                <div style="color: #8b5a2b; margin-bottom: 20px; font-size: 1.3em; text-align: center; font-weight: bold;">
                    Suas moedas: <span id="shopCoins">0</span> üí∞
                </div>
                <div class="shop-items" id="shopItems"></div>
            </div>
        </div>

        <!-- Tela de Invent√°rio -->
        <div class="inventory-screen" id="inventoryScreen">
            <div class="menu-paper">
                <button class="back-btn" onclick="game.backToMenu()">‚Üê Voltar</button>
                <h2 style="color: #2c1810; margin-bottom: 20px; text-align: center; border-bottom: 3px solid #8b5a2b; padding-bottom: 10px;">üéí Invent√°rio</h2>
                <div class="inventory-grid" id="inventoryGrid"></div>
            </div>
        </div>

        <!-- Editar Personagem -->
        <div class="character-creation" id="characterEdit">
            <div class="creation-box">
                <button class="back-btn" onclick="game.backToMenu()">‚Üê Voltar</button>
                <h2>üë§ EDITAR PERSONAGEM</h2>
                
                <div class="avatar-preview">
                    <div class="avatar-display" id="avatarEditPreview">ü¶∏</div>
                </div>

                <div class="input-group">
                    <label>Nome do Personagem</label>
                    <input type="text" id="characterEditName" placeholder="Digite o nome" maxlength="20">
                </div>

                <div class="input-group">
                    <label>Escolha seu Avatar</label>
                    <div class="emoji-grid" id="avatarEditGrid"></div>
                </div>

                <button class="btn" onclick="game.saveCharacterEdit()">Salvar Altera√ß√µes</button>
            </div>
        </div>
    </div>

    <script>
        const game = {
            data: {
                users: {},
                currentUser: null
            },
            
            battle: {
                player: null,
                enemy: null,
                turn: 'player',
                battleCount: 0,
                battlesUntilBoss: 5,
                isProcessing: false
            },

            shopItems: [
                {id: 1, name: 'Espada de Ferro', icon: 'üó°Ô∏è', attack: 5, price: 100},
                {id: 2, name: 'Escudo de Madeira', icon: 'üõ°Ô∏è', defense: 5, price: 100},
                {id: 3, name: 'Po√ß√£o de For√ßa', icon: 'üí™', attack: 10, price: 250},
                {id: 4, name: 'Armadura Leve', icon: 'ü¶∫', defense: 10, price: 250},
                {id: 5, name: 'Espada M√°gica', icon: '‚öîÔ∏è', attack: 15, price: 500},
                {id: 6, name: 'Escudo de A√ßo', icon: 'üõ°Ô∏è', defense: 15, price: 500},
                {id: 7, name: 'Amuleto da Sorte', icon: 'üîÆ', attack: 8, defense: 8, price: 600},
                {id: 8, name: 'Botas R√°pidas', icon: 'üë¢', attack: 12, price: 400},
                {id: 9, name: 'Capa M√≠stica', icon: 'üß•', defense: 20, price: 700},
                {id: 10, name: 'Anel de Poder', icon: 'üíç', attack: 20, defense: 5, price: 1000}
            ],

            bossDrops: [
                {id: 101, name: 'L√¢mina do Drag√£o', icon: 'üêâ', attack: 30, defense: 10},
                {id: 102, name: 'Armadura Lend√°ria', icon: '‚öúÔ∏è', defense: 40, attack: 10},
                {id: 103, name: 'Cajado Arcano', icon: 'ü™Ñ', attack: 35, defense: 15},
                {id: 104, name: 'Elmo do Tit√£', icon: 'üëë', defense: 35, attack: 15},
                {id: 105, name: 'Manopla Divina', icon: 'ü•ä', attack: 40, defense: 20},
                {id: 106, name: 'Orbe do Caos', icon: 'üîÆ', attack: 50, defense: 25},
                {id: 107, name: 'Artefato Supremo', icon: '‚ú®', attack: 60, defense: 40}
            ],

            enemyAvatars: ['üëπ', 'üë∫', 'üëª', 'üëΩ', 'ü§ñ', 'ü¶ñ', 'üêâ', 'üßü', 'üßõ', 'üê∫'],
            playerAvatars: ['ü¶∏', 'üßô', 'ü•∑', 'üë®‚ÄçüöÄ', 'ü§¥', 'üë∏', 'üßù', 'ü¶π', 'üë©‚ÄçüöÄ', 'üßë‚Äçüé§'],
            
            selectedAvatar: 'ü¶∏',

            init() {
                this.loadGameData();
                this.setupAvatarGrid();
                console.log('Jogo inicializado!');
                console.log('Dados atuais:', this.data);
            },

            loadGameData() {
                try {
                    const saved = localStorage.getItem('rpgBattleGame');
                    console.log('Dados salvos encontrados:', saved);
                    if (saved) {
                        this.data = JSON.parse(saved);
                        console.log('Dados carregados com sucesso:', this.data);
                    } else {
                        console.log('Nenhum dado salvo encontrado, iniciando novo jogo');
                        this.data = {
                            users: {},
                            currentUser: null
                        };
                    }
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    this.data = {
                        users: {},
                        currentUser: null
                    };
                }
            },

            saveGameData() {
                try {
                    localStorage.setItem('rpgBattleGame', JSON.stringify(this.data));
                    console.log('Dados salvos com sucesso:', this.data);
                } catch (error) {
                    console.error('Erro ao salvar dados:', error);
                    alert('Erro ao salvar dados! Verifique o console.');
                }
            },

            setupAvatarGrid() {
                const grid = document.getElementById('avatarGrid');
                const editGrid = document.getElementById('avatarEditGrid');
                
                if (grid) {
                    grid.innerHTML = '';
                    this.playerAvatars.forEach(emoji => {
                        const div = document.createElement('div');
                        div.className = `emoji-option ${emoji === this.selectedAvatar ? 'selected' : ''}`;
                        div.textContent = emoji;
                        div.onclick = () => this.selectAvatar(emoji);
                        grid.appendChild(div);
                    });
                }

                if (editGrid) {
                    editGrid.innerHTML = '';
                    this.playerAvatars.forEach(emoji => {
                        const div = document.createElement('div');
                        div.className = `emoji-option ${emoji === this.selectedAvatar ? 'selected' : ''}`;
                        div.textContent = emoji;
                        div.onclick = () => this.selectAvatarEdit(emoji);
                        editGrid.appendChild(div);
                    });
                }
            },

            selectAvatar(emoji) {
                this.selectedAvatar = emoji;
                document.getElementById('avatarPreview').textContent = emoji;
                this.setupAvatarGrid();
            },

            selectAvatarEdit(emoji) {
                this.selectedAvatar = emoji;
                document.getElementById('avatarEditPreview').textContent = emoji;
                this.setupAvatarGrid();
            },

            login() {
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;

                console.log('Tentando login com:', username);
                console.log('Usu√°rios registrados:', Object.keys(this.data.users));

                if (!username || !password) {
                    alert('‚ùå Preencha todos os campos!');
                    return;
                }

                if (this.data.users[username]) {
                    console.log('Usu√°rio encontrado:', this.data.users[username]);
                    if (this.data.users[username].password === password) {
                        console.log('Senha correta! Fazendo login...');
                        this.data.currentUser = username;
                        this.showMainMenu();
                    } else {
                        console.log('Senha incorreta!');
                        alert('‚ùå Senha incorreta!');
                    }
                } else {
                    console.log('Usu√°rio n√£o encontrado!');
                    alert('‚ùå Usu√°rio n√£o encontrado!');
                }
            },

            register() {
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;

                console.log('Tentando registrar:', username);

                if (!username || !password) {
                    alert('‚ùå Preencha todos os campos!');
                    return;
                }

                if (username.length < 3) {
                    alert('‚ùå O usu√°rio deve ter pelo menos 3 caracteres!');
                    return;
                }

                if (password.length < 4) {
                    alert('‚ùå A senha deve ter pelo menos 4 caracteres!');
                    return;
                }

                if (this.data.users[username]) {
                    alert('‚ùå Usu√°rio j√° existe! Fa√ßa login ou escolha outro nome.');
                    return;
                }

                this.data.users[username] = {
                    password: password,
                    characterCreated: false
                };

                this.data.currentUser = username;
                console.log('Usu√°rio registrado:', this.data.users[username]);
                this.saveGameData();
                
                alert('‚úÖ Conta criada com sucesso! Agora crie seu personagem.');
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('characterCreation').style.display = 'block';
            },

            createCharacter() {
                const name = document.getElementById('characterName').value.trim();
                
                if (!name) {
                    alert('‚ùå Digite um nome para seu personagem!');
                    return;
                }

                const user = this.data.users[this.data.currentUser];
                user.characterCreated = true;
                user.name = name;
                user.avatar = this.selectedAvatar;
                user.level = 1;
                user.xp = 0;
                user.coins = 0;
                user.wins = 0;
                user.inventory = [];
                user.equipped = [];

                this.saveGameData();
                alert('‚úÖ Personagem criado com sucesso!');
                this.showMainMenu();
            },

            showMainMenu() {
                const user = this.data.users[this.data.currentUser];
                
                if (!user.characterCreated) {
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('characterCreation').style.display = 'block';
                    return;
                }

                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('characterCreation').style.display = 'none';
                document.getElementById('mainMenu').style.display = 'block';
                this.updateMenuStats();
            },

            updateMenuStats() {
                const user = this.data.users[this.data.currentUser];
                document.getElementById('playerNameDisplay').textContent = user.name;
                document.getElementById('playerLevelMenu').textContent = user.level;
                document.getElementById('playerXpMenu').textContent = `${user.xp}/${user.level * 100}`;
                document.getElementById('playerCoinsMenu').textContent = `üí∞ ${user.coins}`;
                document.getElementById('playerWinsMenu').textContent = user.wins;
            },

            logout() {
                if (confirm('Deseja realmente sair?')) {
                    this.data.currentUser = null;
                    document.getElementById('mainMenu').style.display = 'none';
                    document.getElementById('loginScreen').style.display = 'flex';
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                }
            },

            generateEnemy(isBoss = false) {
                const user = this.data.users[this.data.currentUser];
                const baseLevel = user.level;
                const levelVariation = Math.floor(Math.random() * 3) - 1;
                const enemyLevel = Math.max(1, baseLevel + levelVariation);

                const avatar = this.enemyAvatars[Math.floor(Math.random() * this.enemyAvatars.length)];
                const names = isBoss ? 
                    ['Drag√£o Negro', 'Lorde das Trevas', 'Tit√£ Supremo', 'Imperador Maligno', 'Guardi√£o Ancestral'] :
                    ['Goblin', 'Orc', 'Zumbi', 'Esqueleto', 'Troll', 'Dem√¥nio', 'Bandido', 'Lobisomem'];
                
                const name = names[Math.floor(Math.random() * names.length)];
                const multiplier = isBoss ? 2 : 1;

                return {
                    name: isBoss ? `üëë ${name}` : name,
                    level: enemyLevel,
                    maxHp: 100 + (enemyLevel - 1) * 20 * multiplier,
                    hp: 100 + (enemyLevel - 1) * 20 * multiplier,
                    attack: 10 + (enemyLevel - 1) * 3 * multiplier,
                    defense: 5 + (enemyLevel - 1) * 2 * multiplier,
                    avatar: isBoss ? 'üëë' : avatar,
                    isBoss: isBoss
                };
            },

            startBattle() {
                const user = this.data.users[this.data.currentUser];
                this.battle.battleCount++;
                this.battle.battlesUntilBoss--;

                const isBoss = this.battle.battlesUntilBoss === 0;
                if (isBoss) {
                    this.battle.battlesUntilBoss = 5;
                }

                let bonusAttack = 0;
                let bonusDefense = 0;
                user.equipped.forEach(itemId => {
                    const item = [...this.shopItems, ...this.bossDrops].find(i => i.id === itemId);
                    if (item) {
                        bonusAttack += item.attack || 0;
                        bonusDefense += item.defense || 0;
                    }
                });

                this.battle.player = {
                    name: user.name,
                    level: user.level,
                    maxHp: 100 + (user.level - 1) * 20,
                    hp: 100 + (user.level - 1) * 20,
                    attack: 10 + (user.level - 1) * 3 + bonusAttack,
                    defense: 5 + (user.level - 1) * 2 + bonusDefense,
                    avatar: user.avatar
                };

                this.battle.enemy = this.generateEnemy(isBoss);
                this.battle.turn = 'player';
                this.battle.isProcessing = false;

                document.getElementById('mainMenu').style.display = 'none';
                document.getElementById('battleScreen').style.display = 'block';
                document.getElementById('battleLog').innerHTML = '';

                this.updateBattleUI();
                this.addLog(`üéÆ Batalha iniciada contra ${this.battle.enemy.name}!`);
                
                document.getElementById('battleCount').textContent = this.battle.battleCount;
                document.getElementById('bossCountdown').textContent = this.battle.battlesUntilBoss;

                document.getElementById('specialBtn').disabled = user.level < 5;
                document.getElementById('ultimateBtn').disabled = user.level < 15;
            },

            updateBattleUI() {
                const player = this.battle.player;
                const enemy = this.battle.enemy;

                document.getElementById('playerAvatar').textContent = player.avatar;
                document.getElementById('playerName').textContent = player.name;
                document.getElementById('playerLevel').textContent = player.level;
                document.getElementById('playerHpText').textContent = `${Math.max(0, Math.floor(player.hp))}/${player.maxHp}`;
                document.getElementById('playerHpBar').style.width = `${Math.max(0, (player.hp / player.maxHp) * 100)}%`;

                document.getElementById('enemyAvatar').textContent = enemy.avatar;
                document.getElementById('enemyName').textContent = enemy.name;
                document.getElementById('enemyLevel').textContent = enemy.level;
                document.getElementById('enemyHpText').textContent = `${Math.max(0, Math.floor(enemy.hp))}/${enemy.maxHp}`;
                document.getElementById('enemyHpBar').style.width = `${Math.max(0, (enemy.hp / enemy.maxHp) * 100)}%`;
            },

            addLog(message) {
                const log = document.getElementById('battleLog');
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.textContent = message;
                log.appendChild(entry);
                log.scrollTop = log.scrollHeight;
            },

            showDamageText(damage, x, y) {
                const damageEl = document.createElement('div');
                damageEl.className = 'damage-text';
                damageEl.textContent = `-${damage}`;
                damageEl.style.left = x + 'px';
                damageEl.style.top = y + 'px';
                document.body.appendChild(damageEl);

                setTimeout(() => {
                    damageEl.remove();
                }, 1200);
            },

            playerAttack(type) {
                if (this.battle.turn !== 'player' || this.battle.isProcessing) return;

                this.battle.isProcessing = true;

                const player = this.battle.player;
                const enemy = this.battle.enemy;
                const user = this.data.users[this.data.currentUser];

                let damage = 0;
                let attackName = '';

                switch(type) {
                    case 'normal':
                        damage = Math.floor(player.attack * (0.8 + Math.random() * 0.4));
                        attackName = 'Ataque Normal';
                        break;
                    case 'special':
                        if (user.level < 5) {
                            this.battle.isProcessing = false;
                            return;
                        }
                        damage = Math.floor(player.attack * 1.5 * (0.9 + Math.random() * 0.3));
                        attackName = 'Ataque Especial';
                        break;
                    case 'ultimate':
                        if (user.level < 15) {
                            this.battle.isProcessing = false;
                            return;
                        }
                        damage = Math.floor(player.attack * 2.5 * (0.9 + Math.random() * 0.3));
                        attackName = 'Ataque Supremo';
                        break;
                }

                const finalDamage = Math.max(1, damage - enemy.defense);
                enemy.hp -= finalDamage;

                document.getElementById('playerAvatar').classList.add('attacking');
                setTimeout(() => {
                    document.getElementById('playerAvatar').classList.remove('attacking');
                    document.getElementById('enemyAvatar').classList.add('damaged');
                    
                    const enemyEl = document.getElementById('enemyAvatar');
                    const rect = enemyEl.getBoundingClientRect();
                    this.showDamageText(finalDamage, rect.left + rect.width / 2, rect.top);
                    
                    setTimeout(() => {
                        document.getElementById('enemyAvatar').classList.remove('damaged');
                    }, 500);
                }, 250);

                this.addLog(`‚öîÔ∏è ${player.name} usou ${attackName}! Causou ${finalDamage} de dano!`);

                this.updateBattleUI();

                if (enemy.hp <= 0) {
                    setTimeout(() => this.endBattle(true), 1000);
                    return;
                }

                this.battle.turn = 'enemy';
                setTimeout(() => this.enemyAttack(), 1500);
            },

            enemyAttack() {
                const player = this.battle.player;
                const enemy = this.battle.enemy;

                const damage = Math.floor(enemy.attack * (0.8 + Math.random() * 0.4));
                const finalDamage = Math.max(1, damage - player.defense);
                player.hp -= finalDamage;

                document.getElementById('enemyAvatar').classList.add('attacking');
                setTimeout(() => {
                    document.getElementById('enemyAvatar').classList.remove('attacking');
                    document.getElementById('playerAvatar').classList.add('damaged');
                    
                    const playerEl = document.getElementById('playerAvatar');
                    const rect = playerEl.getBoundingClientRect();
                    this.showDamageText(finalDamage, rect.left + rect.width / 2, rect.top);
                    
                    setTimeout(() => {
                        document.getElementById('playerAvatar').classList.remove('damaged');
                    }, 500);
                }, 250);

                this.addLog(`üí• ${enemy.name} atacou! Causou ${finalDamage} de dano!`);

                this.updateBattleUI();

                if (player.hp <= 0) {
                    setTimeout(() => this.endBattle(false), 1000);
                    return;
                }

                this.battle.turn = 'player';
                this.battle.isProcessing = false;
            },

            endBattle(playerWon) {
                const user = this.data.users[this.data.currentUser];

                if (playerWon) {
                    this.addLog(`üéâ Vit√≥ria! ${this.battle.enemy.name} foi derrotado!`);
                    
                    const xpGain = 20 + this.battle.enemy.level * 5;
                    const coinsGain = 10 + this.battle.enemy.level * 3;
                    
                    user.xp += xpGain;
                    user.coins += coinsGain;
                    user.wins++;

                    this.addLog(`‚ú® +${xpGain} XP | +${coinsGain} moedas üí∞`);

                    if (this.battle.enemy.isBoss) {
                        const randomDrop = this.bossDrops[Math.floor(Math.random() * this.bossDrops.length)];
                        if (!user.inventory.includes(randomDrop.id)) {
                            user.inventory.push(randomDrop.id);
                            this.addLog(`üéÅ Item lend√°rio: ${randomDrop.icon} ${randomDrop.name}!`);
                        }
                    }

                    const xpNeeded = user.level * 100;
                    if (user.xp >= xpNeeded && user.level < 50) {
                        user.level++;
                        user.xp = user.xp - xpNeeded;
                        this.addLog(`üÜô LEVEL UP! Agora voc√™ √© n√≠vel ${user.level}!`);
                    }

                    this.saveGameData();

                    setTimeout(() => {
                        if (confirm('‚úÖ Vit√≥ria! Continuar lutando?')) {
                            this.startBattle();
                        } else {
                            this.backToMenu();
                        }
                    }, 2000);
                } else {
                    this.addLog(`üíÄ Derrota! Voc√™ foi derrotado...`);
                    setTimeout(() => {
                        alert('üíÄ Voc√™ foi derrotado! Voltando ao menu...');
                        this.backToMenu();
                    }, 2000);
                }
            },

            backToMenu() {
                document.getElementById('battleScreen').style.display = 'none';
                document.getElementById('shopScreen').style.display = 'none';
                document.getElementById('inventoryScreen').style.display = 'none';
                document.getElementById('characterEdit').style.display = 'none';
                document.getElementById('mainMenu').style.display = 'block';
                this.updateMenuStats();
            },

            openShop() {
                document.getElementById('mainMenu').style.display = 'none';
                document.getElementById('shopScreen').style.display = 'block';

                const user = this.data.users[this.data.currentUser];
                document.getElementById('shopCoins').textContent = user.coins;

                const shopContainer = document.getElementById('shopItems');
                shopContainer.innerHTML = '';

                this.shopItems.forEach(item => {
                    const owned = user.inventory.includes(item.id);
                    const div = document.createElement('div');
                    div.className = 'shop-item';
                    div.innerHTML = `
                        <div class="shop-item-icon">${item.icon}</div>
                        <div class="shop-item-name">${item.name}</div>
                        <div class="shop-item-stats">
                            ${item.attack ? `‚öîÔ∏è +${item.attack} ATK` : ''} 
                            ${item.defense ? `üõ°Ô∏è +${item.defense} DEF` : ''}
                        </div>
                        <div class="shop-item-price">üí∞ ${item.price}</div>
                        <button class="buy-btn" onclick="game.buyItem(${item.id})" ${owned ? 'disabled' : ''}>
                            ${owned ? '‚úì Comprado' : 'Comprar'}
                        </button>
                    `;
                    shopContainer.appendChild(div);
                });
            },

            buyItem(itemId) {
                const user = this.data.users[this.data.currentUser];
                const item = this.shopItems.find(i => i.id === itemId);

                if (!item) return;

                if (user.coins >= item.price) {
                    user.coins -= item.price;
                    user.inventory.push(itemId);
                    this.saveGameData();
                    alert(`‚úÖ ${item.name} comprado com sucesso!`);
                    this.openShop();
                } else {
                    alert('‚ùå Moedas insuficientes!');
                }
            },

            openInventory() {
                document.getElementById('mainMenu').style.display = 'none';
                document.getElementById('inventoryScreen').style.display = 'block';

                const user = this.data.users[this.data.currentUser];
                const inventoryContainer = document.getElementById('inventoryGrid');
                inventoryContainer.innerHTML = '';

                if (user.inventory.length === 0) {
                    inventoryContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #5c3317; font-size: 1.2em;">Invent√°rio vazio</p>';
                    return;
                }

                user.inventory.forEach(itemId => {
                    const item = [...this.shopItems, ...this.bossDrops].find(i => i.id === itemId);
                    if (!item) return;

                    const equipped = user.equipped.includes(itemId);
                    const div = document.createElement('div');
                    div.className = `inventory-item ${equipped ? 'equipped' : ''}`;
                    div.innerHTML = `
                        <div class="shop-item-icon">${item.icon}</div>
                        <div class="shop-item-name">${item.name}</div>
                        <div class="shop-item-stats">
                            ${item.attack ? `‚öîÔ∏è +${item.attack}` : ''} 
                            ${item.defense ? `üõ°Ô∏è +${item.defense}` : ''}
                        </div>
                        <button class="equip-btn" onclick="game.toggleEquip(${itemId})">
                            ${equipped ? '‚úì Equipado' : 'Equipar'}
                        </button>
                    `;
                    inventoryContainer.appendChild(div);
                });
            },

            toggleEquip(itemId) {
                const user = this.data.users[this.data.currentUser];
                const index = user.equipped.indexOf(itemId);

                if (index > -1) {
                    user.equipped.splice(index, 1);
                } else {
                    user.equipped.push(itemId);
                }

                this.saveGameData();
                this.openInventory();
            },

            openCharacterEdit() {
                const user = this.data.users[this.data.currentUser];
                this.selectedAvatar = user.avatar;
                
                document.getElementById('mainMenu').style.display = 'none';
                document.getElementById('characterEdit').style.display = 'block';
                
                document.getElementById('characterEditName').value = user.name;
                document.getElementById('avatarEditPreview').textContent = user.avatar;
                this.setupAvatarGrid();
            },

            saveCharacterEdit() {
                const user = this.data.users[this.data.currentUser];
                const newName = document.getElementById('characterEditName').value.trim();
                
                if (!newName) {
                    alert('‚ùå Digite um nome v√°lido!');
                    return;
                }

                user.name = newName;
                user.avatar = this.selectedAvatar;
                this.saveGameData();
                
                alert('‚úÖ Personagem atualizado com sucesso!');
                this.backToMenu();
            }
        };

        // Inicializar o jogo
        window.onload = () => {
            game.init();
        };
    </script>
</body>
</html>